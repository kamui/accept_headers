<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Accept headers by kamui</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Accept headers</h1>
          <h2>A ruby library that does content negotiation and parses and sorts http accept headers</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/kamui/accept_headers/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/kamui/accept_headers/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/kamui/accept_headers" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><a href="https://travis-ci.org/kamui/accept_headers"><img src="https://travis-ci.org/kamui/accept_headers.png" alt="Build Status"></a>
<a href="https://codeclimate.com/github/kamui/accept_headers"><img src="https://codeclimate.com/github/kamui/accept_headers/badges/gpa.svg" alt="Code Climate"></a>
<a href="https://codeclimate.com/github/kamui/accept_headers"><img src="https://codeclimate.com/github/kamui/accept_headers/badges/coverage.svg" alt="Test Coverage"></a></p>

<h1>
<a id="acceptheaders" class="anchor" href="#acceptheaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>AcceptHeaders</h1>

<p><strong>AcceptHeaders</strong> is a ruby library that does content negotiation and parses and sorts http accept headers.</p>

<p>Some features of the library are:</p>

<ul>
<li>Strict adherence to <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC 2616</a>, specifically <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">section 14</a>
</li>
<li>Full support for the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.1">Accept</a>, <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3">Accept-Encoding</a>,
and <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.4">Accept-Language</a> HTTP request headers</li>
<li>
<code>Accept-Charset</code> is not supported because it's <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation#The_Accept-Charset.3A_header">obsolete</a>
</li>
<li>Parser tested against all IANA registered <a href="https://www.iana.org/assignments/media-types/media-types.xhtml">media types</a> and <a href="https://www.iana.org/assignments/http-parameters/http-parameters.xml#content-coding">encodings</a>
</li>
<li>A comprehensive <a href="http://github.com/kamui/accept_headers/tree/master/spec/">spec suite</a> that covers many edge cases</li>
</ul>

<p>This library is optimistic when parsing headers. If a specific media type, encoding, or language can't be parsed, is in an invalid format, or contains invalid characters, it will skip that specific entry when constructing the sorted list. If a <code>q</code> value can't be read or is in the wrong format (more than 3 decimal places), it will default it to <code>0.001</code> so it still has a chance to match. Lack of an explicit <code>q</code> value of course defaults to 1.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s1"><span class="pl-pds">'</span>accept_headers<span class="pl-pds">'</span></span></pre></div>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install accept_headers
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="accept" class="anchor" href="#accept" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accept</h3>

<p><code>AcceptHeaders::MediaType::Negotiator</code> is a class that is initialized with an <code>Accept</code> header string and will internally store an array of <code>MediaType</code>s in descending order according to the spec, which takes into account <code>q</code> value, <code>type</code>/<code>subtype</code> and <code>params</code> specificity.</p>

<div class="highlight highlight-ruby"><pre>accept_header <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>Accept: text/*;q=0.3, text/html;q=0.7, text/html;level=1, text/html;level=2;q=0.4, */*;q=0.5<span class="pl-pds">'</span></span>
media_types <span class="pl-k">=</span> <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>::<span class="pl-s3">Negotiator</span>.<span class="pl-k">new</span>(accept_header)

media_types.list

<span class="pl-c"># Returns:</span>

[
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>html<span class="pl-pds">'</span></span>, <span class="pl-c1">params:</span> { <span class="pl-s1"><span class="pl-pds">'</span>level<span class="pl-pds">'</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span> }),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>html<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.7</span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.5</span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>html<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.4</span>, <span class="pl-c1">params:</span> { <span class="pl-s1"><span class="pl-pds">'</span>level<span class="pl-pds">'</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">'</span>2<span class="pl-pds">'</span></span> }),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.3</span>)
]</pre></div>

<p><code>#negotiate</code> takes an array of media range strings supported (by your API or route/controller) and returns a hash where the <code>supported</code> key contains the array element matched and the <code>matched</code> key containing a <code>MediaType</code> that was matched in the <code>Negotiator</code>s internal list.</p>

<p>This will first check the available list for any matching media types with a <code>q</code> of 0 and skip any matches. It does this because the RFC specifies that if the <code>q</code> value is 0, then content with this parameter is <code>not acceptable</code>. Then it'll look to the highest <code>q</code> values and look for matches in descending <code>q</code> value order and return the first match (accounting for wildcards). Finally, if there are no matches, it returns <code>nil</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># The same media_types variable as above</span>
media_types.negotiate([<span class="pl-s1"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>])

<span class="pl-c"># Returns:</span>

{
  <span class="pl-c1">supported:</span> <span class="pl-s1"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>,
  <span class="pl-c1">matched:</span>    <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">MediaType</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>text<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>html<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">1</span>, <span class="pl-c1">params:</span> { <span class="pl-s1"><span class="pl-pds">'</span>level<span class="pl-pds">'</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span> })
}</pre></div>

<p><code>#accept?</code>:</p>

<div class="highlight highlight-ruby"><pre>media_types.accept?(<span class="pl-s1"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>) <span class="pl-c"># true</span></pre></div>

<h3>
<a id="accept-encoding" class="anchor" href="#accept-encoding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accept-Encoding</h3>

<p><code>AcceptHeader::Encoding::Encoding</code>:</p>

<div class="highlight highlight-ruby"><pre>accept_encoding <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>Accept-Encoding: deflate; q=0.5, gzip, compress; q=0.8, identity<span class="pl-pds">'</span></span>
encodings <span class="pl-k">=</span> <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Encoding</span>::<span class="pl-s3">Negotiator</span>.<span class="pl-k">new</span>(accept_encoding)

encodings.list

<span class="pl-c"># Returns:</span>

[
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Encoding</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>gzip<span class="pl-pds">'</span></span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Encoding</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>compress<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.8</span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Encoding</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>deflate<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.5</span>)
]</pre></div>

<p><code>#negotiate</code>:</p>

<div class="highlight highlight-ruby"><pre>encodings.negotiate([<span class="pl-s1"><span class="pl-pds">'</span>gzip<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>compress<span class="pl-pds">'</span></span>])

<span class="pl-c"># Returns:</span>

{
  <span class="pl-c1">supported:</span> <span class="pl-s1"><span class="pl-pds">'</span>gzip<span class="pl-pds">'</span></span>,
  <span class="pl-c1">matched:</span>    <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Encoding</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>gzip<span class="pl-pds">'</span></span>))
}</pre></div>

<p><code>#accept?</code>:</p>

<div class="highlight highlight-ruby"><pre>encodings.accept?(<span class="pl-s1"><span class="pl-pds">'</span>gzip<span class="pl-pds">'</span></span>) <span class="pl-c"># true</span>

<span class="pl-c"># Identity is accepted as long as it's not explicitly rejected 'identity;q=0'</span>

encodings.accept?(<span class="pl-s1"><span class="pl-pds">'</span>identity<span class="pl-pds">'</span></span>) <span class="pl-c"># true</span></pre></div>

<h3>
<a id="accept-language" class="anchor" href="#accept-language" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accept-Language</h3>

<p><code>Accept::Language::Negotiator</code>:</p>

<div class="highlight highlight-ruby"><pre>accept_language <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>Accept-Language: en-*, en-us, *;q=0.8<span class="pl-pds">'</span></span>
languages <span class="pl-k">=</span> <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Language</span>::<span class="pl-s3">Negotiator</span>.<span class="pl-k">new</span>(accept_language)

languages.list

<span class="pl-c"># Returns:</span>

[
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Language</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>en<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>us<span class="pl-pds">'</span></span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Language</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>en<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>),
  <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Language</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-c1">q:</span> <span class="pl-c1">0.8</span>)
]</pre></div>

<p><code>#negotiate</code>:</p>

<div class="highlight highlight-ruby"><pre>languages.negotiate([<span class="pl-s1"><span class="pl-pds">'</span>en-us<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>zh-Hant<span class="pl-pds">'</span></span>])

<span class="pl-c"># Returns:</span>

{
  <span class="pl-c1">supported:</span> <span class="pl-s1"><span class="pl-pds">'</span>en-us<span class="pl-pds">'</span></span>,
  <span class="pl-c1">matched:</span>    <span class="pl-s3">AcceptHeaders</span>::<span class="pl-s3">Language</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>en<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>us<span class="pl-pds">'</span></span>))
}</pre></div>

<p><code>#accept?</code>:</p>

<div class="highlight highlight-ruby"><pre>languages.accept?(<span class="pl-s1"><span class="pl-pds">'</span>en-gb<span class="pl-pds">'</span></span>) <span class="pl-c"># true</span></pre></div>

<h2>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>Write rack middleware</li>
<li>More edge case tests</li>
<li>Add rdoc</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it ( <a href="https://github.com/%5Bmy-github-username%5D/accept_headers/fork">https://github.com/[my-github-username]/accept_headers/fork</a> )</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new Pull Request</li>
</ol>
        </section>

        <footer>
          Accept headers is maintained by <a href="https://github.com/kamui">kamui</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-18119942-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>